# Coding Rules

gog-lite の実装時に守るルールをまとめる。

## 変更方針

- 目的に対して最小差分で修正する。
- 無関係な命名変更・ファイル移動・フォーマット大量変更を混ぜない。
- 既存の CLI 振る舞い（フラグ名・JSONキー・終了コード）を安易に変更しない。

## 出力契約

- stdout は正常時 JSON オブジェクトのみ。
- stderr はエラー時 JSON のみ（`error`, `code`）。
- stdout/stderr を混在させない。

## セキュリティ・安全性

- `policy_denied` / `approval_required` / confirm フラグ要件を維持する。
- `--dry-run` では外部 API 呼び出しをしない。
- 監査ログ（`audit.log`）は書き込み操作の痕跡を残す。
- credentials / token / password をソース・ログへ出さない。

## エラー設計

- 既存 code 体系を優先して再利用する（新規 code 追加は最小限）。
- エラーメッセージは原因と対処が分かる具体性を持たせる。

## テスト

- 変更箇所に対応するユニットテストを追加/更新する。
- 失敗経路テストでは共有固定ファイルを避ける（`mktemp` を利用）。
- CI で揺れやすい箇所は、空レスポンスや race を明示的にガードする。

## ドキュメント更新

- ユーザー影響がある変更は `README.md` か `docs/*.md` を同PRで更新する。
